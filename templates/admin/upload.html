{% extends "admin/layouts/base.html" %} {% block title %}Upload Article{%
endblock %} {% block content %}
<div
    class="container"
    style="
        padding: 20px;
        max-width: 800px;
        margin: 20px auto;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    "
>
    <h1>Upload Journal</h1>
    <p>Use this form to upload a new journal article to the database.</p>

    <form
        action="/admin/upload"
        {#
        action
        points
        to
        the
        correct
        POST
        route
        #}
        method="post"
        enctype="multipart/form-data"
        style="margin-top: 20px"
        id="uploadForm"
    >
        {# Add CSRF token here if using CSRF protection #}

        <div class="form-group">
            <label for="title">Title</label>
            <input
                type="text"
                id="title"
                name="title"
                required
                class="form-control"
            />
            {# Assuming form-control styling #}
        </div>

        <div class="form-group">
            <label for="authors">Authors (comma separated)</label>
            <input
                type="text"
                id="authors"
                name="authors"
                required
                class="form-control"
            />
        </div>

        {# Use form-row or similar for layout #}
        <div style="display: flex; gap: 1rem; margin-bottom: 1.2rem">
            <div class="form-group" style="flex: 1">
                <label for="volume">Volume</label>
                <input
                    type="text"
                    id="volume"
                    name="volume"
                    required
                    class="form-control"
                />
            </div>
            <div class="form-group" style="flex: 1">
                <label for="pages">Pages</label>
                <input
                    type="text"
                    id="pages"
                    name="pages"
                    required
                    class="form-control"
                />
            </div>
            <div class="form-group" style="flex: 1">
                <label for="publication_date">Publication Date</label>
                <input
                    type="date"
                    id="publication_date"
                    name="publication_date"
                    required
                    class="form-control"
                />
            </div>
        </div>

        <div class="form-group">
            <label for="abstract_text">Abstract</label>
            <textarea
                id="abstract_text"
                name="abstract_text"
                rows="5"
                required
                class="form-control"
            ></textarea>
        </div>

        <div class="form-group">
            <label for="keywords">Keywords (comma separated)</label>
            <input
                type="text"
                id="keywords"
                name="keywords"
                required
                class="form-control"
            />
        </div>

        <div class="form-group">
            <label for="pdf">PDF File</label>
            <div class="upload-file">
                {# Style this appropriately #}
                <input type="file" id="pdf" name="pdf" accept=".pdf" required />
            </div>
            <p
                class="file-note"
                style="font-size: 0.85rem; color: #666; margin-top: 0.5rem"
            >
                Only PDF files are accepted.
            </p>
        </div>

        <button
            class="submit-btn upload-btn"
            type="submit"
            style="margin-top: 1rem"
        >
            Upload Journal
        </button>
        {# Use existing button styles #}
    </form>

    <div id="uploadStatus" style="margin-top: 20px; display: none">
        <p class="success" style="color: green"></p>
        <p class="error" style="color: red"></p>
    </div>
</div>
{% endblock %} {% block scripts %}
<script>
    // Keep the existing JS for upload status handling
    document
        .getElementById("uploadForm")
        ?.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const statusDiv = document.getElementById("uploadStatus");
            const successMsg = statusDiv.querySelector(".success");
            const errorMsg = statusDiv.querySelector(".error");
            const submitButton = e.target.querySelector(
                'button[type="submit"]',
            );

            submitButton.disabled = true; // Disable button during upload
            submitButton.textContent = "Uploading...";
            statusDiv.style.display = "none"; // Hide previous status
            successMsg.textContent = "";
            errorMsg.textContent = "";

            try {
                const response = await fetch("/admin/upload", {
                    // Ensure URL matches POST route
                    method: "POST",
                    body: formData,
                    // Add headers if needed (e.g., CSRF token)
                });

                const result = await response.json();

                statusDiv.style.display = "block";
                if (response.ok && result.success) {
                    successMsg.textContent =
                        result.message || "Upload successful!";
                    errorMsg.textContent = "";
                    e.target.reset(); // Clear form on success
                    setTimeout(() => {
                        statusDiv.style.display = "none";
                    }, 5000); // Hide status after 5s
                } else {
                    successMsg.textContent = "";
                    errorMsg.textContent = `Error: ${result.message || response.statusText || "Upload failed"}`;
                }
            } catch (error) {
                console.error("Upload error:", error);
                statusDiv.style.display = "block";
                successMsg.textContent = "";
                errorMsg.textContent =
                    "An unexpected error occurred during upload.";
            } finally {
                submitButton.disabled = false; // Re-enable button
                submitButton.textContent = "Upload Journal";
            }
        });
</script>
{% endblock %}
